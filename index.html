<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <title>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</title>

    <!-- Bootstrap CSS ‡∏à‡∏≤‡∏Å CDN -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    >

    <style>
      body {
        background-color: #f5f7fb;
        font-family: "TH Sarabun New", system-ui, -apple-system, "Segoe UI", sans-serif;
      }

      .navbar {
        background: linear-gradient(90deg, #003f7d, #005fa3);
      }

      .navbar-brand, .nav-link, .navbar-text {
        color: #fff !important;
      }

      .page-title {
        margin-top: 1.5rem;
        margin-bottom: 1rem;
      }

      .card {
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-radius: 0.75rem;
      }

      .table thead {
        background-color: #003f7d;
        color: #fff;
      }

      .required::after {
        content: " *";
        color: red;
      }

      #app-section {
        display: none; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞ Login */
      }
    </style>
  </head>

  <body>
    <!-- üîµ Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid">
        <span class="navbar-brand">
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
        </span>
        <div class="ms-auto">
          <span class="navbar-text me-3" id="currentUserLabel" style="display:none;">
            ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <span id="currentUserName"></span>
          </span>
          <button class="btn btn-outline-light btn-sm" id="btnLogout" style="display:none;">
            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
          </button>
        </div>
      </div>
    </nav>

    <div class="container my-4">

      <!-- üü° Login Section -->
      <div id="login-section" class="row justify-content-center">
        <div class="col-md-5">
          <div class="card">
            <div class="card-header text-center">
              <h5 class="mb-0">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h5>
            </div>
            <div class="card-body">
              <form id="loginForm">
                <div class="mb-3">
                  <label class="form-label required">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                  <input type="text" class="form-control" id="loginUsername" required>
                </div>
                <div class="mb-3">
                  <label class="form-label required">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                  <input type="password" class="form-control" id="loginPassword" required>
                </div>
                <div class="d-grid">
                  <button type="submit" class="btn btn-primary">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                  </button>
                </div>
              </form>
              <div class="mt-3 text-center text-muted" style="font-size:0.9rem;">
                <div>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: admin / 1234 (‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ‡πÉ‡∏ô Code.gs)</div>
              </div>
              <div id="loginMessage" class="mt-3 text-center text-danger" style="display:none;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- üü¢ App Section (‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏•‡∏±‡∏á Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à) -->
      <div id="app-section">
        <!-- ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏ô‡πâ‡∏≤ -->
        <div class="page-title">
          <h4>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ / ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ú‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</h4>
          <p class="text-muted mb-0">
            ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô
          </p>
        </div>

        <div class="row">
          <!-- ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° -->
          <div class="col-lg-4">
            <div class="card mb-4">
              <div class="card-header">
                <h6 class="mb-0" id="formTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</h6>
              </div>
              <div class="card-body">
                <form id="budgetForm">
                  <!-- hidden id -->
                  <input type="hidden" id="budgetId">

                  <div class="mb-3">
                    <label class="form-label required">‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label>
                    <input type="text" class="form-control" id="fiscalYear" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2568" required>
                  </div>

                  <div class="mb-3">
                    <label class="form-label required">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label>
                    <input type="text" class="form-control" id="budgetType" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏á‡∏ö‡∏•‡∏á‡∏ó‡∏∏‡∏ô, ‡∏á‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô" required>
                  </div>

                  <div class="mb-3">
                    <label class="form-label required">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
                    <input type="text" class="form-control" id="department" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏á‡∏≤‡∏ô‡πÅ‡∏ú‡∏ô‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏™‡∏î‡∏∏" required>
                  </div>

                  <div class="mb-3">
                    <label class="form-label required">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" class="form-control" id="amount" min="0" step="0.01" required>
                  </div>

                  <div class="mb-3">
                    <label class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <textarea class="form-control" id="remark" rows="2"></textarea>
                  </div>

                  <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-success" id="btnSave">
                      ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button type="button" class="btn btn-secondary" id="btnClear">
                      ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                    </button>
                  </div>
                </form>
                <div id="formMessage" class="mt-3 text-center" style="display:none;"></div>
              </div>
            </div>
          </div>

          <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
          <div class="col-lg-8">
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h6 class="mb-0">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</h6>
                <small class="text-muted" id="recordCountLabel"></small>
              </div>
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-sm mb-0 align-middle">
                    <thead>
                      <tr class="text-center">
                        <th style="width: 5%;">ID</th>
                        <th style="width: 12%;">‡∏õ‡∏µ‡∏á‡∏ö</th>
                        <th style="width: 20%;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏ö‡∏Ø</th>
                        <th style="width: 23%;">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
                        <th style="width: 15%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                        <th style="width: 10%;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                        <th style="width: 15%;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                      </tr>
                    </thead>
                    <tbody id="budgetTableBody">
                      <tr>
                        <td colspan="7" class="text-center py-4 text-muted">
                          ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

        </div><!-- /.row -->
      </div><!-- /#app-section -->
    </div><!-- /.container -->

    <!-- Bootstrap JS (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö modal ‡∏Ø‡∏•‡∏Ø ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"></script>

    <script>
      let isLoggedIn = false;

      // ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Login
      const loginForm = document.getElementById('loginForm');
      const loginSection = document.getElementById('login-section');
      const appSection = document.getElementById('app-section');
      const loginMessage = document.getElementById('loginMessage');

      const currentUserLabel = document.getElementById('currentUserLabel');
      const currentUserName = document.getElementById('currentUserName');
      const btnLogout = document.getElementById('btnLogout');

      loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('loginUsername').value.trim();
        const password = document.getElementById('loginPassword').value.trim();

        loginMessage.style.display = 'none';
        loginMessage.textContent = '';

        google.script.run
          .withSuccessHandler(function(res) {
            if (res && res.success) {
              isLoggedIn = true;

              // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
              currentUserName.textContent = username;
              currentUserLabel.style.display = 'inline-block';
              btnLogout.style.display = 'inline-block';

              // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ login ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ app
              loginSection.style.display = 'none';
              appSection.style.display = 'block';

              // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á
              loadBudgetTable();
            } else {
              loginMessage.textContent = (res && res.message) ? res.message : '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ';
              loginMessage.style.display = 'block';
            }
          })
          .withFailureHandler(function(err) {
            loginMessage.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message;
            loginMessage.style.display = 'block';
          })
          .checkLogin(username, password);
      });

      // ‚úÖ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö (‡πÅ‡∏Ñ‡πà‡∏•‡πâ‡∏≤‡∏á state ‡∏ù‡∏±‡πà‡∏á client)
      btnLogout.addEventListener('click', function() {
        isLoggedIn = false;
        appSection.style.display = 'none';
        loginSection.style.display = 'flex';
        currentUserLabel.style.display = 'none';
        btnLogout.style.display = 'none';
        document.getElementById('loginForm').reset();
      });

      // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á
      function loadBudgetTable() {
        const tbody = document.getElementById('budgetTableBody');
        tbody.innerHTML = `
          <tr>
            <td colspan="7" class="text-center py-4 text-muted">
              ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
            </td>
          </tr>
        `;

        google.script.run
          .withSuccessHandler(function(data) {
            renderBudgetTable(data || []);
          })
          .withFailureHandler(function(err) {
            tbody.innerHTML = `
              <tr>
                <td colspan="7" class="text-center py-4 text-danger">
                  ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ${err.message}
                </td>
              </tr>
            `;
          })
          .getAllBudgets();
      }

      // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á
      function renderBudgetTable(items) {
        const tbody = document.getElementById('budgetTableBody');
        const recordCountLabel = document.getElementById('recordCountLabel');

        if (!items || items.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="7" class="text-center py-4 text-muted">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
              </td>
            </tr>
          `;
          recordCountLabel.textContent = '0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
          return;
        }

        recordCountLabel.textContent = items.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';

        tbody.innerHTML = '';
        items.forEach(function(item) {
          const tr = document.createElement('tr');

          const amountFormatted = Number(item.amount || 0).toLocaleString('th-TH', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
          });

          let updatedText = '';
          if (item.updatedAt && item.updatedAt.toString) {
            updatedText = new Date(item.updatedAt).toLocaleDateString('th-TH');
          }

          tr.innerHTML = `
            <td class="text-center">${item.id || ''}</td>
            <td class="text-center">${item.fiscalYear || ''}</td>
            <td>${item.budgetType || ''}</td>
            <td>${item.department || ''}</td>
            <td class="text-end">${amountFormatted}</td>
            <td class="text-center">${updatedText}</td>
            <td class="text-center">
              <button class="btn btn-sm btn-outline-primary me-1" data-action="edit" data-id="${item.id}">
                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
              </button>
              <button class="btn btn-sm btn-outline-danger" data-action="delete" data-id="${item.id}">
                ‡∏•‡∏ö
              </button>
            </td>
          `;

          tbody.appendChild(tr);
        });

        // ‡∏ú‡∏π‡∏Å event ‡∏õ‡∏∏‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö
        tbody.querySelectorAll('button[data-action="edit"]').forEach(function(btn) {
          btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            const item = items.find(x => String(x.id) === String(id));
            if (item) {
              fillFormForEdit(item);
            }
          });
        });

        tbody.querySelectorAll('button[data-action="delete"]').forEach(function(btn) {
          btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ID ' + id + ' ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
              deleteBudget(id);
            }
          });
        });
      }

      // ‚úÖ ‡πÄ‡∏ï‡∏¥‡∏°‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      function fillFormForEdit(item) {
        document.getElementById('budgetId').value = item.id || '';
        document.getElementById('fiscalYear').value = item.fiscalYear || '';
        document.getElementById('budgetType').value = item.budgetType || '';
        document.getElementById('department').value = item.department || '';
        document.getElementById('amount').value = item.amount || '';
        document.getElementById('remark').value = item.remark || '';

        document.getElementById('formTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (ID: ' + item.id + ')';
        document.getElementById('btnSave').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
      }

      // ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
      const budgetForm = document.getElementById('budgetForm');
      const formMessage = document.getElementById('formMessage');
      const btnClear = document.getElementById('btnClear');

      budgetForm.addEventListener('submit', function(e) {
        e.preventDefault();
        if (!isLoggedIn) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô');
          return;
        }

        const data = {
          id: document.getElementById('budgetId').value || null,
          fiscalYear: document.getElementById('fiscalYear').value.trim(),
          budgetType: document.getElementById('budgetType').value.trim(),
          department: document.getElementById('department').value.trim(),
          amount: document.getElementById('amount').value.trim(),
          remark: document.getElementById('remark').value.trim()
        };

        formMessage.style.display = 'none';
        formMessage.className = '';
        formMessage.textContent = '';

        google.script.run
          .withSuccessHandler(function(res) {
            if (res && res.success) {
              formMessage.textContent = res.message || '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢';
              formMessage.className = 'mt-3 text-center text-success';
              formMessage.style.display = 'block';

              // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°
              clearForm();
              // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
              loadBudgetTable();
            } else {
              formMessage.textContent = (res && res.message) ? res.message : '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';
              formMessage.className = 'mt-3 text-center text-danger';
              formMessage.style.display = 'block';
            }
          })
          .withFailureHandler(function(err) {
            formMessage.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message;
            formMessage.className = 'mt-3 text-center text-danger';
            formMessage.style.display = 'block';
          })
          .saveBudget(data);
      });

      // ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
      btnClear.addEventListener('click', function() {
        clearForm();
      });

      function clearForm() {
        budgetForm.reset();
        document.getElementById('budgetId').value = '';
        document.getElementById('formTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì';
        document.getElementById('btnSave').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
      }

      // ‚úÖ ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      function deleteBudget(id) {
        formMessage.style.display = 'none';
        formMessage.textContent = '';

        google.script.run
          .withSuccessHandler(function(res) {
            if (res && res.success) {
              loadBudgetTable();
            } else {
              alert(res && res.message ? res.message : '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
            }
          })
          .withFailureHandler(function(err) {
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message);
          })
          .deleteBudget(id);
      }
    </script>
  </body>
</html>
